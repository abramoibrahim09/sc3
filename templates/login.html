@app.route("/", methods=["GET", "POST"])
def login():
    if request.method == "POST":
        username_input = request.form.get("username", "").strip()
        password_input = request.form.get("password", "").strip()

        # Controllo admin (case-insensitive)
        for admin_name, admin_pass in ADMINS.items():
            if username_input.lower() == admin_name.lower() and password_input == admin_pass:
                session["user"] = admin_name
                session["admin"] = True
                return redirect(url_for("admin_page"))

        # Controllo visualizzatori
        for p in PARTECIPANTI:
            if username_input.lower() == p.lower():
                session["user"] = p
                session["admin"] = False
                return redirect(url_for("viewer_page"))

        error = "Nome utente o password non validi!"
        return render_template("login.html", error=error)

    return render_template("login.html")
