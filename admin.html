<!DOCTYPE html>
<h2>Benvenuto {{ user }} (Admin)</h2>
<h3>Classifica</h3>
<table border="1" style="width:100%;max-width:900px">
<tr>
<th>Partecipante</th>
<th>Punti</th>
<th>Azione</th>
</tr>
{% for p, d in data.items() %}
<tr>
<td>{{ p }}</td>
<td id="punti-{{ p }}">{{ d['punti'] }}</td>
<td>
{% for cat, val in categorie.items() %}
<button onclick="aggiorna('{{ p }}','{{ cat }}', {{ val }})">+{{ val }} {{ cat }}</button>
<button onclick="aggiorna('{{ p }}','{{ cat }}', -{{ val }})">-{{ val }} {{ cat }}</button>
{% endfor %}
<br>
<input type="number" id="manual-{{ p }}" placeholder="Altro punti" style="width:120px">
<button onclick="manual('{{ p }}')">Aggiorna</button>
</td>
</tr>
{% endfor %}
</table>


<script>
function aggiorna(partecipante, categoria, punti) {
$.post("/update_points", {partecipante: partecipante, categoria: categoria, punti: punti}, function(data){
if(data.status=='success') {
$('#punti-'+partecipante).text(data.punti);
} else {
alert('Errore: ' + (data.message || 'errore sconosciuto'));
}
}).fail(function(xhr){ alert('Errore server'); });
}


function manual(partecipante) {
var punti = parseInt($('#manual-'+partecipante).val());
if(!isNaN(punti)) {
$.post("/update_points", {partecipante: partecipante, categoria: 'MANUALE', punti: punti}, function(data){
if(data.status=='success') {
$('#punti-'+partecipante).text(data.punti);
$('#manual-'+partecipante).val('');
} else {
alert('Errore: ' + (data.message || 'errore'));
}
}).fail(function(){ alert('Errore server'); });
}
}
</script>


<br><a href="/export_csv">Esporta CSV</a>
</body>
</html>
